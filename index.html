<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D人生ゲーム</title>
  <style>
    :root{
      --bg:#0f172a;         /* 深いネイビー */
      --panel:#121a2e;      /* パネル */
      --ink:#e5e7eb;        /* 文字 */
      --muted:#94a3b8;      /* 補助文字 */
      --brand:#38bdf8;      /* アクセント（控えめ） */
      --pos:#22c55e;        /* + ボタン */
      --neg:#ef4444;        /* - ボタン */
      --clear:#94a3b8;      /* クリア */
      --ring: rgba(56,189,248,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:grid;place-items:center;background:linear-gradient(135deg, var(--bg), #111827);color:var(--ink);font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;padding:16px}

    .app{width:min(720px, 100%); background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.45); padding:16px}
    h1{margin:4px 0 12px; text-align:center; font-size:1.35rem}

    /* タブ（学年） */
    .tabs{display:flex; gap:8px; justify-content:center; margin:8px 0 12px}
    .tab{flex:1; max-width: 180px; display:flex; align-items:center; justify-content:center; padding:10px; border-radius:12px; cursor:pointer; border:1px solid rgba(255,255,255,.12); background:#0b1220; color:var(--muted); font-weight:700}
    .tab[aria-selected="true"]{color:#0b1220; background:linear-gradient(180deg, #c7eaff, #7dd3fc); border-color:#7dd3fc}

    /* 入力・表示 */
    .stack{display:grid; gap:12px}
    .panel{background:#0b1220; border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    label{font-size:.95rem; color:var(--muted)}
    input[type="text"]{flex:1; min-width: 220px; width: 100%; padding:14px; font-size:1.1rem; color:var(--ink); background:#0a1426; border:1px solid rgba(255,255,255,.15); border-radius:12px; outline:none}
    input[type="text"]:focus{box-shadow:0 0 0 3px var(--ring); border-color:#7dd3fc}

    .display{ text-align:center; padding:10px 12px; border-radius:14px; background: radial-gradient(80% 100% at 20% 10%, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08)}
    .display .label{font-size:.9rem; color:var(--muted)}
    .display .value{font-variant-numeric: tabular-nums; font-size: clamp(30px, 7vw, 54px); font-weight:800; letter-spacing:.02em}

    .grid{display:grid; gap:10px; grid-template-columns: repeat(2, minmax(0,1fr))}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:.4em; padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.12); font-weight:800; cursor:pointer; user-select:none}
    .btn.pos{background:#0f2a19; color:#c8f8d7; border-color: rgba(34,197,94,.35)}
    .btn.neg{background:#2a1212; color:#ffd5d5; border-color: rgba(239,68,68,.35)}
    .btn.clear{background:#111827; color:#d1d5db; border-color: rgba(148,163,184,.35)}

    .summary{margin-top:12px; display:grid; gap:8px}
    .sumrow{display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:#0b1220; border:1px solid rgba(255,255,255,.08); border-radius:12px}
    .sumrow .label{color:var(--muted)}
    .sumrow.total{border-color:#7dd3fc}

    .hint{color:var(--muted); font-size:.9rem}
  </style>
</head>
<body>
  <main class="app" role="application" aria-label="3D人生ゲーム - 学年別計算（統合）">
    <h1>3D人生ゲーム</h1>

    <!-- 学年タブ -->
    <nav class="tabs" role="tablist" aria-label="学年を選択">
      <button class="tab" id="tab-y1" role="tab" aria-controls="panel-y1" aria-selected="true" data-year="1">1年生</button>
      <button class="tab" id="tab-y2" role="tab" aria-controls="panel-y2" aria-selected="false" data-year="2">2年生</button>
      <button class="tab" id="tab-y3" role="tab" aria-controls="panel-y3" aria-selected="false" data-year="3">3年生</button>
    </nav>

    <section class="stack" aria-live="polite">
      <!-- 初期設定（1年生のみ表示） -->
      <div class="panel" id="init-panel">
        <div class="row">
          <label for="initial">1年生の初期金額：</label>
          <input id="initial" type="text" inputmode="numeric" placeholder="例：10,000（カンマOK）" />
          <button class="btn" id="setBtn" aria-label="初期金額を設定" style="background:#0a1426; color:#cfeefd; border-color:#7dd3fc">設定</button>
        </div>
        <div class="hint">※ 1年生は任意の初期値から開始。2年生・3年生は 0 円から開始します。</div>
      </div>

      <!-- 表示領域（選択中の学年のみ共通表示） -->
      <div class="display">
        <div class="label" id="gradeLabel">現在：1年生</div>
        <div class="value" id="value">0円</div>
      </div>

      <!-- 操作ボタン（共通） -->
      <div class="panel">
        <div class="grid">
          <button class="btn pos" data-delta="1000">＋1,000円</button>
          <button class="btn neg" data-delta="-1000">−1,000円</button>
          <button class="btn pos" data-delta="10000">＋10,000円</button>
          <button class="btn neg" data-delta="-10000">−10,000円</button>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn clear" id="clearBtn">クリア（0円）</button>
        </div>
      </div>

      <!-- サマリー（全学年の現在値と総合計） -->
      <aside class="summary" aria-label="学年別サマリー">
        <div class="sumrow"><span class="label">1年生</span><strong id="sum1">0円</strong></div>
        <div class="sumrow"><span class="label">2年生</span><strong id="sum2">0円</strong></div>
        <div class="sumrow"><span class="label">3年生</span><strong id="sum3">0円</strong></div>
        <div class="sumrow total"><span class="label">最終合計</span><strong id="total">0円</strong></div>
      </aside>
    </section>
  </main>

  <script>
    // サウンド（プラス/マイナスで音を分ける）
    let audioCtx;
    function beep(freq = 440, durationMs = 140, type = 'sine'){
      try {
        audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
        const t0 = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, t0);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        // クリックノイズを避けるためのエンベロープ
        gain.gain.setValueAtTime(0.0001, t0);
        gain.gain.exponentialRampToValueAtTime(0.18, t0 + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, t0 + durationMs/1000);
        osc.start(t0);
        osc.stop(t0 + durationMs/1000 + 0.02);
      } catch (_) { /* モバイルの制限などで失敗しても無視 */ }
    }

    // 状態
    const amounts = {1:0, 2:0, 3:0};
    let currentYear = 1; // 現在操作中の学年

    // 要素
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const initPanel = document.getElementById('init-panel');
    const initialInput = document.getElementById('initial');
    const setBtn = document.getElementById('setBtn');

    const gradeLabel = document.getElementById('gradeLabel');
    const valueEl = document.getElementById('value');

    const clearBtn = document.getElementById('clearBtn');
    const opBtns = Array.from(document.querySelectorAll('[data-delta]'));

    const sum1 = document.getElementById('sum1');
    const sum2 = document.getElementById('sum2');
    const sum3 = document.getElementById('sum3');
    const total = document.getElementById('total');

    // 表示用フォーマッタ（カンマ + 円）
    const yenFmt = new Intl.NumberFormat('ja-JP');
    const toYen = n => `${yenFmt.format(n)}円`;

    // 文字列→数値（カンマ/全角対応）
    function parseInput(str){
      if(!str) return 0;
      const normalized = str.toString()
        .replace(/[\u3000\s]/g, '')
        .replace(/[０-９]/g, s => String.fromCharCode(s.charCodeAt(0)-0xFEE0))
        .replace(/,/g, '');
      const n = Number(normalized);
      return Number.isFinite(n) ? Math.trunc(n) : 0;
    }

    // 画面更新
    function render(){
      // 選択中学年ラベルと値
      gradeLabel.textContent = `現在：${currentYear}年生`;
      valueEl.textContent = toYen(amounts[currentYear]);
      // サマリー
      sum1.textContent = toYen(amounts[1]);
      sum2.textContent = toYen(amounts[2]);
      sum3.textContent = toYen(amounts[3]);
      total.textContent = toYen(amounts[1] + amounts[2] + amounts[3]);
      // 1年生タブ時のみ初期入力パネルを表示
      initPanel.style.display = currentYear === 1 ? 'block' : 'none';
    }

    // 学年切り替え
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const y = Number(tab.dataset.year);
        if(y === currentYear) return;
        currentYear = y;
        tabs.forEach(t => t.setAttribute('aria-selected', String(t === tab)));
        render();
      });
    });

    // 1年生の初期金額セット
    setBtn.addEventListener('click', () => {
      const v = parseInput(initialInput.value);
      amounts[1] = v; // 1年生のみ任意の初期値から開始
      render();
      initialInput.blur();
    });
    initialInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') setBtn.click(); });

    // 増減操作（現在選択中の学年に適用）
    opBtns.forEach(btn => btn.addEventListener('click', () => {
      const delta = Number(btn.dataset.delta) || 0;
      amounts[currentYear] += delta;
      amounts[currentYear] = Math.trunc(amounts[currentYear]);
      // 音：プラス高め / マイナス低め
      if (delta >= 0) beep(880, 140, 'sine'); else beep(220, 160, 'sine');
      render();
    }));

    // クリア（選択中学年のみ0円へ）
    clearBtn.addEventListener('click', () => { amounts[currentYear] = 0; render(); });

    // 初期化（2・3年は0円開始）
    render();
  </script>
</body>
</html>
